{{ define "alert.summary" }}
{{- if .CommonAnnotations.summary -}}
{{ .CommonAnnotations.summary }}
{{- else -}}
{{ .GroupLabels.alertname }} - {{ len .Alerts }} alert(s)
{{- end -}}
{{ end }}

{{ define "alert.description" }}
{{- if .CommonAnnotations.description -}}
{{ .CommonAnnotations.description }}
{{- else -}}
Multiple alerts detected for {{ .GroupLabels.alertname }}
{{- end -}}
{{ end }}

{{ define "slack.title" }}
{{ if eq .Status "firing" }}ðŸ”¥{{ else }}âœ…{{ end }} {{ template "alert.summary" . }}
{{ end }}

{{ define "slack.text" }}
*Status:* {{ .Status | title }}
*Severity:* {{ .GroupLabels.severity | title }}
*Service:* {{ .GroupLabels.service }}

{{ range .Alerts }}
*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
{{- if .Labels.instance }}
*Instance:* {{ .Labels.instance }}
{{- end }}
{{- if .Annotations.runbook_url }}
*Runbook:* {{ .Annotations.runbook_url }}
{{- end }}
{{- if .Annotations.dashboard_url }}
*Dashboard:* {{ .Annotations.dashboard_url }}
{{- end }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{- if .EndsAt }}
*Ended:* {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
{{- end }}
{{ end }}
{{ end }}

{{ define "email.subject" }}
{{ if eq .Status "firing" }}ðŸ”¥ ALERT{{ else }}âœ… RESOLVED{{ end }}: {{ template "alert.summary" . }}
{{ end }}

{{ define "email.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background-color: {{ if eq .Status "firing" }}#d32f2f{{ else }}#388e3c{{ end }}; color: white; padding: 15px; border-radius: 5px; }
        .alert { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .critical { border-left: 5px solid #d32f2f; }
        .warning { border-left: 5px solid #f57c00; }
        .info { border-left: 5px solid #1976d2; }
        .label { font-weight: bold; color: #333; }
        .value { color: #666; }
        .footer { margin-top: 20px; padding: 10px; background-color: #f5f5f5; border-radius: 5px; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h2>{{ if eq .Status "firing" }}ðŸ”¥ SmartAttend Alert{{ else }}âœ… Alert Resolved{{ end }}</h2>
        <p>{{ template "alert.summary" . }}</p>
    </div>
    
    <div style="margin: 20px 0;">
        <p><span class="label">Status:</span> <span class="value">{{ .Status | title }}</span></p>
        <p><span class="label">Severity:</span> <span class="value">{{ .GroupLabels.severity | title }}</span></p>
        <p><span class="label">Service:</span> <span class="value">{{ .GroupLabels.service }}</span></p>
        <p><span class="label">Total Alerts:</span> <span class="value">{{ len .Alerts }}</span></p>
    </div>

    {{ range .Alerts }}
    <div class="alert {{ .Labels.severity }}">
        <h3>{{ .Annotations.summary }}</h3>
        <p><span class="label">Description:</span> {{ .Annotations.description }}</p>
        {{ if .Labels.instance }}<p><span class="label">Instance:</span> {{ .Labels.instance }}</p>{{ end }}
        {{ if .Labels.job }}<p><span class="label">Job:</span> {{ .Labels.job }}</p>{{ end }}
        <p><span class="label">Started:</span> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
        {{ if .EndsAt }}<p><span class="label">Ended:</span> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}</p>{{ end }}
        {{ if .Annotations.runbook_url }}<p><a href="{{ .Annotations.runbook_url }}" style="color: #1976d2;">ðŸ“– View Runbook</a></p>{{ end }}
        {{ if .Annotations.dashboard_url }}<p><a href="{{ .Annotations.dashboard_url }}" style="color: #1976d2;">ðŸ“Š View Dashboard</a></p>{{ end }}
    </div>
    {{ end }}

    <div class="footer">
        <p>This alert was generated by SmartAttend Monitoring System</p>
        <p>Time: {{ .CommonAnnotations.timestamp | default now }}</p>
        <p>For support, contact: devops@smartattend.com</p>
    </div>
</body>
</html>
{{ end }}

{{ define "pagerduty.description" }}
{{ template "alert.summary" . }} - {{ template "alert.description" . }}
{{ end }}

{{ define "webhook.default" }}
{
  "status": "{{ .Status }}",
  "receiver": "{{ .Receiver }}",
  "groupKey": "{{ .GroupKey }}",
  "groupLabels": {{ .GroupLabels | toJson }},
  "commonLabels": {{ .CommonLabels | toJson }},
  "commonAnnotations": {{ .CommonAnnotations | toJson }},
  "externalURL": "{{ .ExternalURL }}",
  "alerts": [
    {{ range $i, $alert := .Alerts }}
    {{ if $i }},{{ end }}
    {
      "status": "{{ $alert.Status }}",
      "labels": {{ $alert.Labels | toJson }},
      "annotations": {{ $alert.Annotations | toJson }},
      "startsAt": "{{ $alert.StartsAt }}",
      "endsAt": "{{ $alert.EndsAt }}",
      "generatorURL": "{{ $alert.GeneratorURL }}"
    }
    {{ end }}
  ]
}
{{ end }}
